================================================================================
OAKERDS ACCOUNTING APP - CODING RULES
================================================================================

These rules apply to ALL code generation for this project.

--------------------------------------------------------------------------------
1. CENTRALIZED UTILITIES - NEVER DUPLICATE
--------------------------------------------------------------------------------

ACCOUNT CODES (src/utils/accounts.ts)
- Import: ACCOUNT_CODE_RANGES, ACCOUNT_TYPE_IDS, SPECIAL_ACCOUNTS
- Import helpers: isBankCode, isBusinessCardCode, isPersonalCardCode, 
  isPersonalDebtCode, isHelocCode, isCreditCardCode, isRentalExpenseCode,
  isFlipExpenseCode, isMarketingExpenseCode, isRentalIncomeCode,
  isRealEstateAssetCode, isMortgageCode
- NEVER hardcode account ranges (e.g., code >= 1000 && code <= 1999)
- ALWAYS use: ACCOUNT_CODE_RANGES.BANK_MIN, ACCOUNT_CODE_RANGES.BANK_MAX, etc.

FORMATTING (src/utils/format.ts)
- Import: formatCurrency, formatMoney, formatCurrencyOptional, formatPercent
- formatCurrency(value, decimals) - use decimals=0 for whole dollars
- formatMoney(value) - alias for formatCurrency(value, 2)
- NEVER create local formatCurrency or formatMoney functions

DATES (src/utils/date.ts)
- Import: formatLocalDate
- For ledger components: export { formatLocalDate as formatDate } from '../../utils/date'
- NEVER create local date formatting functions

--------------------------------------------------------------------------------
2. TYPE SAFETY
--------------------------------------------------------------------------------

- AVOID `as any[]` type casting - define proper types instead
- Use `catch (err: unknown)` then `err instanceof Error ? err.message : '...'`
- Define explicit types for Supabase query results

--------------------------------------------------------------------------------
3. ACCOUNTING INTEGRITY
--------------------------------------------------------------------------------

DOUBLE-ENTRY RULES
- Every transaction MUST have lines that sum to zero (debits = credits)
- Never create single-sided transactions
- Opening balances for liabilities offset to asset accounts, not equity
- Opening balances for assets offset to equity accounts

TRANSACTION STRUCTURE
- transactions table: id, date, description
- transaction_lines table: transaction_id, account_id, amount, is_cleared, purpose
- Positive amounts = debits (expenses, assets)
- Negative amounts = credits (income, liabilities)

CLEARED vs UNCLEARED
- YTD reports: use is_cleared = true only
- Balance sheet: use ALL transactions (cleared + uncleared)

--------------------------------------------------------------------------------
4. FILE ORGANIZATION
--------------------------------------------------------------------------------

IMPORTS ORDER
1. React imports
2. Supabase client
3. Utility imports (accounts, format, date)
4. Types
5. Components

COMPONENT STRUCTURE
1. Type definitions
2. Props type
3. Component function
4. State declarations
5. Computed values
6. Helper functions (only if truly component-specific)
7. Data fetching
8. Event handlers
9. Styles
10. Return/render

--------------------------------------------------------------------------------
5. LEDGER COMPONENTS (src/components/ledger/)
--------------------------------------------------------------------------------

- Re-export shared utilities: formatDate, formatMoney from utils.ts
- Use ACCOUNT_CODE_RANGES for codeMatchesFilter function
- Types defined in types.ts
- Index exports from index.ts

--------------------------------------------------------------------------------
6. SUPABASE QUERIES
--------------------------------------------------------------------------------

- Always handle errors: if (error) throw error
- Use .select() to specify columns explicitly
- Use proper joins: accounts!inner, transactions!inner
- Foreign key relationships use ON DELETE CASCADE or ON DELETE SET NULL

--------------------------------------------------------------------------------
7. WHAT NOT TO DO
--------------------------------------------------------------------------------

❌ Hardcode account ranges: code >= 2000 && code <= 2099
❌ Create local formatCurrency/formatMoney functions
❌ Create local formatDate functions  
❌ Use `as any[]` without good reason
❌ Create single-sided transactions
❌ Duplicate helper functions that exist in utils/

--------------------------------------------------------------------------------
8. WHAT TO ALWAYS DO
--------------------------------------------------------------------------------

✅ Import from centralized utils (accounts.ts, format.ts, date.ts)
✅ Use ACCOUNT_CODE_RANGES constants
✅ Use helper functions: isBankCode(), isBusinessCardCode(), etc.
✅ Ensure transactions balance (sum of lines = 0)
✅ Define proper TypeScript types
✅ Handle Supabase errors explicitly

--------------------------------------------------------------------------------
9. ACCOUNT CODE RANGES REFERENCE
--------------------------------------------------------------------------------

ASSETS (1xxx, 63xxx)
- Banks: 1000-1999
- RE Assets: 63000-63999

LIABILITIES (2xxx, 64xxx)
- Credit Cards: 2000-2999
  - Business Cards: 2000-2099
  - Personal Cards: 2100-2199
  - Personal Debt: 2200-2299
  - HELOC: 2300-2399
- RE Mortgages: 64000-64999

EQUITY (3xxx)
- Equity: 3000-3999

INCOME (4xxx, 61xxx)
- Job Income: 4000-4999
- Rental Income: 61000-61999

EXPENSES (5xxxx, 6xxxx)
- Overhead: 50000-54999
- Marketing: 55000-55999
- Personal: 60000-60999
- Real Estate Expenses: 62000-62999
  - Rental Expenses: 62000-62099
  - Flip Expenses: 62100-62105

================================================================================
